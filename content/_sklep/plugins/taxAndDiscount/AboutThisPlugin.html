<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
  <title>Tax And Discount</title>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <style type='text/css'>
  @media all {
    html, body { height:100%; }
    body, div, table, td, th { margin:0px; padding:0px; }
    body { font-family: Arial, Helvetica, sans-serif; font-size:14px; }
  }
  @media print {
    body { color:#444444; background-color:#FFFFFF; page-break-after:auto; page-break-before:auto; page-break-inside:auto; }
  }
  @media screen {
    body { color:#444444; background-color:#0000FF; }
  }
  @media all {
    h1 { font-size:2em; margin-top:0px; }
    h2 { font-size:1.5em; margin-bottom:0.4em; }
    h3 { font-size:1.2em; margin-bottom:0.4em; }
    h4 { font-size:1.1em; text-decoration:underline; margin-bottom:0.4em; font-weight:normal; }
    em { font-style:normal; font-weight:bold; }
    ul { list-style-type:disc; }
    ul.circle { list-style-type:circle; }
    ul.square { list-style-type:square; }
    ul.none { list-style-type:none; }
    ol { list-style-type:decimal; }
    ol.alpha { list-style-type:lower-alpha; }
    li { margin-bottom:0.7em; }
    li.close { margin-bottom:0px; }
    a, a:visited { color:#0000EE; background-color:inherit; text-decoration:underline; }
    a:hover { color:#006400; background-color:inherit; text-decoration:none; }
    .clear { clear: both; }
  }
  @media print {
    a { margin-left:5px; }
    div#topofpage { position:absolute; visibility:hidden; }
    #doc, #page, .page { }
    #page div { margin-bottom:1em; }
    #page div.backtop { position:absolute; visibility:hidden; }
    #page .backtop a, #page .backtop a:hover { }
  }
  @media screen {
    div#topofpage { position:static; line-height:1px; }
    #doc { margin-left:auto; margin-right:auto; margin-top:20px; margin-bottom:20px;
           width:80%; border:1px solid #808080; background-color: #FFFFFF; color:inherit; }
    #page, .page { position:relative; top:3px; left:3px; border:1px solid #808080; background-color: #FFFFFF; color:inherit; }
    #page { padding:20px 20px 10px 20px; }
    #page div { margin-bottom:1em; }
    #page div.backtop { position:relative; float:right; text-align:right; border:1px solid #CCCCCC; }
    #page .backtop a { font-size:0.7em; color:#CCCCCC; text-decoration:none; background-color:inherit; }
    #page .backtop a:hover { color:#006400; background-color:inherit; }
  }
  @media all {
    #page .code {margin:5px 0px 5px 15px; border:1px solid #4169E1; padding-left:2px; line-height:1.3em; font-size:0.85em; }
    #page .pre span { color:#808080; background-color:inherit; }
    #page .pre span.hilite { background-color:#FFFF00; color:inherit; }
    #header { color:#FF4040; background-color:inherit; border:1px solid #FF4040; padding:5px; text-align:center; font-size:0.9em; font-style:italic; }
    #info, #index { position:relative; float:right; border:1px solid #606060; padding:3px 5px 3px 5px; margin-left: 10px; margin-bottom:10px; }
    #info div, #index div { margin:0px; }
    #info span { float:left; width:90px; }
    #index ul { list-style-type:none; margin:0px; padding-left:1em; }
    #index ul li { margin-bottom:0px; }
    #cfgsetting, #cfgsetting td { border:1px solid #808080; border-collapse:collapse; }
    #cfgsetting { margin:10px; font-size:0.9em; }
    #cfgsetting td { vertical-align:top; padding:2px 5px 2px 5px; }
    div#theend { clear:both; text-align:center; font-size:0.8em; }
    .file { color:#800080; background-color:inherit; }
    .inlineCode { color:#A52A2A; background-color:inherit; }
    .italic { font-style:italic; }
    .new { color:#FF0000; background-color:inherit; }
  }
  @media print {
    #page .code{ page-break-inside:avoid; }
    #page .pre { color:#A52A2A; margin:0px; background-color:inherit; page-break-after:avoid; page-break-before:avoid; page-break-inside:avoid; }
    .tcode { position:absolute; visibility:hidden; }
  }
  @media screen {
    #page .pre { position:relative; top:-0.8em; color:#A52A2A; margin:0px; background-color:inherit; }
    .tcode { background-color:#FFFFFF; position:relative; top:-0.9em; left:1em; color:#4169E1;
             font-size:0.8em; padding-left:0.2em;padding-right:0.2em; }
  }
  </style>
</head>
<body>
  <div id='topofpage'><a name='topdoc'>&nbsp;</a></div>
  <div id='doc'>
    <div class='page'>
      <div class='page'>
        <div id='page'>
<!--
          <div id='header'>NOTE: A copy of this document resides in the plugin's folder and will be available via the Admin - Plugins screen once installed.</div>
-->
          <div id='info'>
            <div><span>Version</span>: 2.1</div>
            <div><span>Release</span>: Feb 23, 2006</div>
            <div><span>Compatibility</span>: QC v1.0+</div>
            <div><span>Languages</span>: en</div>
            <div><span>Author</span>: Wizzud</div>
            <div><span>Contact</span>: <a href='mailto:rb@wizzud.com'>rb@wizzud.com</a></div>
          </div>
          <h1>Tax And Discount</h1>
          Plugin module for Quick.Cart by <a href='http://www.opensolution.org'>OpenSolution.org</a>
          <div class='clear'></div>
          <div id='index'>
            <div><a href='#synopsis'>Synopsis</a></div>
            <div><a href='#compatibility'>Compatibility</a></div>
            <div><a href='#prerequisites'>Prerequisites</a></div>
            <div><a href='#upgrade'>Upgrade</a></div>
            <ul>
              <li><div><a href='#upgrade20_21'>v2.0 To v2.1</a></div></li>
            </ul>
            <div><a href='#install'>Install</a></div>
            <div><a href='#guide'>User Guide</a></div>
            <ul>
              <li><div><a href='#configuration'>Configuration</a></div></li>
              <li><div><a href='#discounts'>Discount Rates</a></div></li>
              <li><div><a href='#exampleSimple'>Example - Simple</a></div></li>
              <li><div><a href='#exampleComplex'>Example - Complex</a></div></li>
              <li><div><a href='#exampleAmounts'>Example - Amounts</a></div></li>
              <li><div><a href='#exampleNoTax'>Example - No Tax</a></div></li>
              <li><div><a href='#exampleNoDiscount'>Example - No Discount</a></div></li>
              <li><div><a href='#exampleRebate'>Example - Tax Rebate</a></div></li>
            </ul>
            <div><a href='#language'>Language</a></div>
            <div><a href='#changelog'>Change Log</a></div>
            <ul>
              <li><div><a href='#changes21'>Version 2.1</a></div></li>
            </ul>
          </div>

          <a name='synopsis'></a><h2>Synopsis</h2>
          <div>This plugin offers ...</div>
          <ul>
            <li>The ability to apply a tax on orders</li>
            <li>Discounts, at Basket level (not Product level)</li>
            <li>Banded discounts based on total value of Basket or number of items in Basket</li>
            <li>Discounts as a percentage or as an amount</li>
            <li>Options to tax delivery charges, and to exclude tax from total (ie. where product prices already include a tax element)</li>
            <li>Option to provide a pre-tax sub-total <span class='new'>NEW!</span></li>
            <li>Simplified installation and maintenance*</li>
          </ul>
          <div>* Please note the <a href='#prerequisites'>Prerequisites</a> for running this plugin. Due to the complexity of the interaction
               with the core Quick.Cart code it is necessary to use the facilities provided by the Plugin Manager. If this causes any problems
               I apologise in advance, but it is unavoidable.</div>

          <a name='compatibility'></a><h2>Compatibility</h2>
          <div>Quick.Cart versions prior to v1.0 : <em>Not</em> compatible.</div>
          <div>Quick.Cart versions 1.0 upward : Compatible at the time of writing.</div>
          <div>Other Plugins : At the time of release, this plugin is known to be compatible with the following available plugins (other than those listed as <a href='#prerequisites'>Prerequisite</a>):
            <ul>
              <li>productsInRow v1.1</li>
              <li>productAttributes v2.0</li>
              <li>htmlMailOrderDetails v2.0</li>
            </ul></div>
          <div>Any other plugins not mentioned above may or may not work in conjunction with Tax And Discount, but it is always
               worth checking their available documentation to see if they specify compatibility with this plugin.</div>
          <div class='backtop'><a href='#topdoc' name='prerequisites'>Top of Page</a></div>

          <h2>Prerequisites</h2>
          <div><em>Plugin Manager v2.0+</em> : Uses the Plugin Manager's 'extendTplParser' class extension.</div>
          <div>None other, assuming that the <a href='#compatibility'>Compatibility</a> requirements have been met.</div>
          <div class='backtop'><a href='#topdoc' name='upgrade'>Top of Page</a></div>

          <h2>Upgrade</h2>
          <div>There is an upgrade path starting with version 2.0 of this plugin. Lower versions are not upgradable.</div>
          <div class='backtop'><a href='#topdoc' name='upgrade20_21'>Top of Page</a></div>
          <h3>Upgrading v2.0 to v2.1</h3>
          <ol class='alpha'>
            <li>Follow steps 1, 2 and 3 of the <a href='#install'>Installation</a> instructions below, replacing old files/folders
                with the new versions.</li>
            <li>Go to the Configuration - Plugins option on the Admin menu. You will see a warning that the Tax And Discount plugin
                version number has changed. If Plugin Manager has been configured for Version Checking then the plugin will also have
                been disabled and the Configuration button greyed out.
              <ul class='square'>
                <li>Click the Reload Setup button for the Tax And Discount plugin</li>
                <li>Click the Configuration button for the Tax And Discount plugin, make any changes necessary, and Save</li>
                <li>Re-enable the plugin, and Save</li>
              </ul>
            </li>
          </ol>
          <div>For anyone upgrading from earlier versions of Quick.Cart, the extra fields generated by this plugin used to be held
               in the <span class='file'>db/orders.php</span> file, but have been moved to the <span class='file'>db/orders_ext.php</span>
               file since QCv1.0. Conversion routines are available for standard QC upgrades from pre version 1.0 Quick.Cart, but these
               will not suffice for upgrading to this new version of the Tax And Discount plugin - new fields have been introduced which
               were not required/available in previous versions. The only solution I can recommend is that you archive and then clear down your
               existing orders and start from a clean database. In fact, to prevent possible record layout problems due to Quick.Cart's
               upgraded file handling routines, I advise that this clear down be performed regardless when installing this plugin.</div>
          <div class='backtop'><a href='#topdoc' name='install'>Top of Page</a></div>

          <h2>Install</h2>
          <div>Where possible, the release folder is laid out in the correct folder structure to aid installation.</div>
          <ol>
            <li>Copy the entire taxAndDiscount folder from the release/plugins/ folder into your Quick.Cart plugins/ folder.</li>
            <li>Copy the contents of the release/templates/admin/ folder to your Quick.Cart templates/admin/ folder (1 new file: taxAndDiscount.tpl).</li>
            <li>Copy the contents of the release/templates/ folder to your Quick.Cart templates/ folder (1 new file: taxAndDiscount.tpl, <em>NOT</em> the Admin folder!).</li>
            <li>Go to the Configuration - Plugins option on the Admin menu, and configure and then enable the taxAndDiscount plugin.</li>
          </ol>
          <div class='backtop'><a href='#topdoc' name='guide'>Top of Page</a></div>

          <h2>User Guide</h2>
          <div class='backtop'><a href='#topdoc' name='configuration'>Top of Page</a></div>
          <h3>Configuration</h3>
          <div>The plugin's configuration parameters are accessible via the Plugin Manager, and full explanations have been
               provided for each and every setting. Please read them carefully!</div>
          <div>One thing that should be pointed out is that you can enable/disable both tax and/or discount via the configuration
               settings, and that once the plugin has been installed and been in use, then these settings should be used to control
               it in preference to disabling the entire plugin. The reason for this is that the extra fields will still be maintained
               on the <span class='file'>db/orders_ext.php</span> file, which will keep the record layouts compatible between orders
               entered with or without tax and/or discounts being enabled.</div>
          <div class='backtop'><a href='#topdoc' name='discounts'>Top of Page</a></div>
          <h3>Discount Rates</h3>
          <div>The on/off switches and tax rate are fairly self-explanatory, but the discount rates may require a bit of clarification.</div>
          <div>The discount rates consist of an array of sub-arrays. Each sub-array consists of 4 values:</div>
            <ul>
              <li>the trigger amount at which the discount becomes applicable</li>
              <li>the minimum number of items that must be present in the basket for the discount to apply</li>
              <li>the discount</li>
              <li>whether the discount is an amount or a percentage</li>
            </ul>
          <div>The sub-arrays <em>must</em> be presented in ascending order, primarily of the trigger amounts, and within them the trigger items,
               or you will end up with the wrong discount being applied!</div>
          <div>Only the discount for the highest applicable trigger amount/trigger items is applied, and only the basket contents total is
               used to determine which trigger amount is applicable, ie. delivery charges are not included or discounted. The number of items in the
               basket can range from multiple quantities of a single product, to single qauntities of multiple products - all count.</div>
          <div>Discount rates are positive; the calculated amount of discount is presented as negative and therefore subtracted from the total.
               [A negative discount rate would become a surcharge and be added to the total!]</div>
          <div class='backtop'><a href='#topdoc' name='exampleSimple'>Top of Page</a></div>
          <h3>Example - Simple</h3>
          <div>"UK-base trading; product prices and delivery charges are exclusive of VAT; orders of £200 or more receive a 10% discount,
               and orders of £100 - £200 receive a 5% discount; customers should be able to see the discount rate they are getting".</div>
          <ul class='circle'>
            <li class='close'>Enable Tax</li>
            <li class='close'>Enable Discount</li>
            <li class='close'>Tax Rate : 17.5</li>
            <li class='close'>Tax Delivery Cost - enabled</li>
            <li class='close'>Include Tax In Total - enabled</li>
            <li class='close'>Display Tax As Absolute - disabled</li>
            <li class='close'>SubTotal Excluding Tax - disabled</li>
            <li class='close'>Show Discount Rate - enabled</li>
            <li class='close'>Discount Rates :
              <ul class='none'>
                <li class='close'>array(100, 0, 5, '%'),</li>
                <li class='close'>array(200, 0, 10, '%')</li>
              </ul></li>
          </ul>
          <div class='backtop'><a href='#topdoc' name='exampleComplex'>Top of Page</a></div>
          <h3>Example - Complex</h3>
          <div>"Tax rate is 15%; product prices are quoted before tax, but delivery charges are quoted externally and include tax; all
               products ordered online should have a discount of 2%, with an additional 2% for every £100 spent up to a maximum discount
               of 12%; any order of 10 items or more gets an (additional) 3% regardless of amount; customer does not need to see the
               actual discount rate applied".</div>
          <ul class='circle'>
            <li class='close'>Enable Tax</li>
            <li class='close'>Enable Discount</li>
            <li class='close'>Tax Rate : 15</li>
            <li class='close'>Tax Delivery Cost - disabled</li>
            <li class='close'>Include Tax In Total - enabled</li>
            <li class='close'>Display Tax As Absolute - disabled</li>
            <li class='close'>SubTotal Excluding Tax - disabled</li>
            <li class='close'>Show Discount Rate - disabled</li>
            <li class='close'>Discount Rates :
              <ul class='none'>
                <li class='close'>array(0, 0, 2, '%'),</li>
                <li class='close'>array(0, 10, 5, '%'),</li>
                <li class='close'>array(100, 0, 4, '%'),</li>
                <li class='close'>array(100, 10, 7, '%'),</li>
                <li class='close'>array(200, 0, 6, '%'),</li>
                <li class='close'>array(200, 10, 9, '%'),</li>
                <li class='close'>array(300, 0, 8, '%'),</li>
                <li class='close'>array(300, 10, 11, '%'),</li>
                <li class='close'>array(400, 0, 10, '%'),</li>
                <li class='close'>array(400, 10, 13, '%'),</li>
                <li class='close'>array(500, 0, 12, '%'),</li>
                <li class='close'>array(500, 10, 15, '%')</li>
                </ul></li>
          </ul>
          <div class='backtop'><a href='#topdoc' name='exampleAmounts'>Top of Page</a></div>
          <h3>Example - Amounts</h3>
          <div>"Tax rate is 15%; product prices are quoted before tax, but delivery charges are quoted externally and include tax;
               all products are priced at £5 and every tenth item ordered is free, up to a maximum of 5 free items; additionally,
               any spend over £100 gets a 5% discount, over £200 gets 10%; oh, and I'd like to see a pre-tax sub-total".</div>
          <ul class='circle'>
            <li class='close'>Enable Tax</li>
            <li class='close'>Enable Discount</li>
            <li class='close'>Tax Rate : 15</li>
            <li class='close'>Tax Delivery Cost - disabled</li>
            <li class='close'>Include Tax In Total - enabled</li>
            <li class='close'>Display Tax As Absolute - disabled</li>
            <li class='close'>SubTotal Excluding Tax - enabled</li>
            <li class='close'>Show Discount Rate - disabled</li>
            <li class='close'>Discount Rates :
              <ul class='none'>
                <li class='close'>array(0, 10, 5, 'a'),</li>
                <li class='close'>array(0, 20, 5, 'a'),</li>
                <li class='close'>array(0, 30, 5, 'a'),</li>
                <li class='close'>array(0, 40, 5, 'a'),</li>
                <li class='close'>array(0, 50, 5, 'a'),</li>
                <li class='close'>array(100, 0, 5, '%'),</li>
                <li class='close'>array(200, 0, 10, '%')</li>
                </ul></li>
          </ul>
          <div class='backtop'><a href='#topdoc' name='exampleNoTax'>Top of Page</a></div>
          <h3>Example - No Tax</h3>
          <div>"All product prices and delivery charges already include tax and there is no need to show how much tax is being charged;
               all products get a 15% discount on more than 3 items, which the customer should see to encourage him to re-order."</div>
          <ul class='circle'>
            <li class='close'>Disable Tax</li>
            <li class='close'>Enable Discount</li>
            <li class='close'>Tax Rate : irrelevant</li>
            <li class='close'>Tax Delivery Cost - irrelevant</li>
            <li class='close'>Include Tax In Total - irrelevant</li>
            <li class='close'>Display Tax As Absolute - irrelevant</li>
            <li class='close'>SubTotal Excluding Tax - irrelevant</li>
            <li class='close'>Show Discount Rate - enabled</li>
            <li class='close'>Discount Rates :
              <ul class='none'>
                <li class='close'>array(0, 4, 15, '%')</li>
              </ul></li>
          </ul>
          <div class='backtop'><a href='#topdoc' name='exampleNoDiscount'>Top of Page</a></div>
          <h3>Example - No Discount</h3>
          <div>"Tax rate is 14%; product prices and delivery charges already include tax but law requires that the customer be told how much tax
               is being charged (as a positive amount), and that a pre-tax sub-total is displayed; product prices already include any discounts."</div>
          <ul class='circle'>
            <li class='close'>Enable Tax</li>
            <li class='close'>Disable Discount</li>
            <li class='close'>Tax Rate : -12.281</li>
            <li class='close'>Tax Delivery Cost - enabled</li>
            <li class='close'>Include Tax In Total - disabled</li>
            <li class='close'>Display Tax As Absolute - enabled</li>
            <li class='close'>SubTotal Excluding Tax - enabled</li>
            <li class='close'>Show Discount Rate - irrelevant</li>
            <li class='close'>Discount Rates : irrelevant</li>
          </ul>
          <div>NOTE: The tax rate has been set to (negative) 14/114 to get the 14% tax that has been included in all prices.</div>
          <div class='backtop'><a href='#topdoc' name='exampleRebate'>Top of Page</a></div>
          <h3>Example - Tax Rebate</h3>
          <div>[I'm not sure that this is a valid real-life scenario, but ...]</div>
          <div>"The local tax rate is 22%, and all product prices and delivery charges have to be quoted inclusive of tax; however all my
               online customers are entitled to a tax rebate on the products themselves; I can also offer discounts for large orders: 4% on
               orders over $500, 7% on orders over $1000, and a flat 10% where they order more than 50 items."</div>
          <ul class='circle'>
            <li class='close'>Enable Tax</li>
            <li class='close'>Enable Discount</li>
            <li class='close'>Tax Rate : -18.033</li>
            <li class='close'>Tax Delivery Cost - disabled</li>
            <li class='close'>Include Tax In Total - enabled</li>
            <li class='close'>Display Tax As Absolute - disabled</li>
            <li class='close'>SubTotal Excluding Tax - disabled</li>
            <li class='close'>Show Discount Rate - enabled</li>
            <li class='close'>Discount Rates :
              <ul class='none'>
                <li class='close'>array(610.01, 0, 4, '%'),</li>
                <li class='close'>array(610.01, 51, 10, '%'),</li>
                <li class='close'>array(1220.01, 0, 7, '%'),</li>
                <li class='close'>array(1220.01, 51, 10, '%')</li>
              </ul></li>
          </ul>
          <div>NOTE: The tax_rate is -22/122, excludes delivery, displays as negative, and IS included in the total (ie. subtracted from).
               Also, because discount is calculated BEFORE tax, the trigger amounts in the discount_rates have been modified to include the tax
               that will be rebated; and they only come into effect for amounts GREATER THAN $500 or $1000!</div>
          <div class='backtop'><a href='#topdoc' name='language'>Top of Page</a></div>

          <h2>Language</h2>
          <div>By default this plugin is only supplied with an English language file - <span class='file'>/plugins/taxAndDiscount/lang-en.php</span>.</div>
          <div>If you wish to provide translations for your own language, copy lang-en.php to lang-[2-char-code].php (within the same folder), where [2-char-code] is the
               recognised code for your language. For example, a Polish language file would be <span class='file'>/plugins/taxAndDiscount/lang-pl.php</span>.</div>
          <div>The plugin will automatically load the English file first, and then look for the language file in the Shop's configured language, so that the English text is always there as a backup.</div>
          <div class='backtop'><a href='#topdoc' name='changelog'>Top of Page</a></div>

          <h2>Change Log</h2>
          <a name='changes21'></a><h3>Version 2.1</h3>
          <ul class='circle'>
            <li>Code : updated tax.php functions to handle pre-tax sub-total field.</li>
            <li>Javascript : update pre-tax sub-total if present on orders delivery page.</li>
            <li>Template files : added blocks for pre-tax sub-totals - screen and print, shop and admin.</li>
            <li>Configuration : added new boolean for pre-tax sub-total, with appropriate language file updates.</li>
            <li>Stored fields : orders_ext.php now also stores the settings (at the time the order is placed) for 'Display Tax As Absolute' and 'SubTotal Excluding Tax',
                for more accurate re-creation of the order from Admin.</li>
            <li>Setup : upped version number.</li>
            <li>Documentation : corrected 'Example - No Discount'; corrected style to properly show highlight; updated whole document
                to include pre-tax sub-total field.</li>
            <li>General : tidied up unnecessary (old) commented out code; removed tax-admin.php (not used)</li>
          </ul>
          <div class='backtop'><a href='#topdoc'>Top of Page</a></div>

          <div id='theend'>~~ The End ~~</div>
        </div>
      </div>
    </div>
  </div>
  <div class='clear'>&nbsp;</div>
</body>
</html>
